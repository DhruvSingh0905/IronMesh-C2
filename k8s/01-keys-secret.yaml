apiVersion: v1
kind: Service
metadata:
  name: alpha
spec:
  selector:
    app: tactical-mesh
    node: alpha
  ports:
    - protocol: TCP
      port: 9000
      targetPort: 9000
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: alpha
spec:
  replicas: 1
  selector:
    matchLabels:
      app: tactical-mesh
      node: alpha
  template:
    metadata:
      labels:
        app: tactical-mesh
        node: alpha
    spec:
      containers:
      - name: node
        image: tactical-mesh:latest
        imagePullPolicy: Never # Use local image
        env:
        - name: NODE_ID
          value: "Alpha"
        - name: PEERS
          value: "Bravo:bravo,Charlie:charlie" # K8s Service Names!
        volumeMounts:
        - name: keys
          mountPath: "/app/keys"
          readOnly: true
        - name: data
          mountPath: "/data"
      volumes:
      - name: keys
        secret:
          secretName: tactical-keys
      - name: data
        emptyDir: {} # Ephemeral storage for test. Use PVC for prod.